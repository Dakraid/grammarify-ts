"use strict";var spellchecker=require("spellchecker");exports=module.exports=new Grammarify;function Grammarify(){var a=new Grammarify_PreProcess,b=new Grammarify_SMS,c=new Grammarify_Disconnected,d=new Grammarify_Numbers;return{clean:function clean(d){if(0===d.length)return"";d=d.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,"\""),d=a.fixPeriodAndEllipsis(d),d=a.fixSpaceAfterCharacter(d);var e=d.split(" "),f=e.filter(function(a){return 0!==a.length});f=b.fixStretching(f),f=b.fixShorthand(f),f=c.fixSeparated(f);for(var g=[],h=0;h<f.length;h++)0<=f[h].indexOf(".")?g.push("."):0<=f[h].indexOf("!")?g.push("!"):0<=f[h].indexOf("?")?g.push("?"):g.push("");for(var j=["the","a","an","and","but","or","nor","for","so","yet"],k=[],l=!1,m="",n="",o="",p=0;p<f.length;p++){if(0<p&&f[p]===f[p-1].trim().toLowerCase()&&0<=j.indexOf(f[p].toLowerCase())){f.splice(p,1),p--;continue}o=f[p].match(/[\W]+$/g),n=null===o?f[p]:f[p].replace(/[\W]+$/g,""),spellchecker.isMisspelled(n)&&(k=spellchecker.getCorrectionsForMisspelling(n),0<k.length&&(f[p]=k[0],k=[],null!==o&&(f[p]+=o[0]))),0<p&&(l=""!==g[p-1]),(0==p||l)&&(f[p]=f[p][0].toUpperCase()+f[p].substr(1)),0!=p&&(f[p]=" "+f[p])}var q=f.length-1;return m=f[q][f[q].length-1],"."!==m&&"!"!==m&&"?"!==m&&(f[q]+="."),f.join("")}}}function Grammarify_PreProcess(){var a=[",",";",":","%"],b=function(a,b){var c=new RegExp("^[ \\"+b+".]+","g");a=a.replace(c,""),c=new RegExp("\\b([ \\"+b+"]*\\"+b+"[ \\"+b+"]*)(\\b|$)","g");var d=a.match(c),e=0,f="";if(null!==d)for(var g=0;g<d.length;g++)e=a.indexOf(d[g],e),f=a.substr(e),f=e+d[g].length<a.length&&null!==a[e+d[g].length+1].match(/\d/)?f.replace(d[g],b):f.replace(d[g],b+" "),a=a.substr(0,e)+f,e++;return a};return{fixPeriodAndEllipsis:function fixPeriodAndEllipsis(a){a=a.replace(/^[ \.]+/g,"");var b=a.match(/\b([ \.]*\.[ \.]*)(\b|$)/g),c=0,d="";if(null!==b)for(var e=0;e<b.length;e++)c=a.indexOf(b[e],c),2==b[e].split(".").length?(d=a.substr(c),d=d.replace(b[e],". "),a=a.substr(0,c)+d,c++):3<=b[e].split(".").length&&(d=a.substr(c),d=d.replace(b[e],"... "),a=a.substr(0,c)+d,c++);return a},fixSpaceAfterCharacter:function fixSpaceAfterCharacter(c){for(var d=0;d<a.length;d++)c=b(c,a[d]);return c}}}function Grammarify_SMS(){var a={"2night":"tonight","2nite":"tonight",asap:"as soon as possible",asl:"American Sign Language",bc:"because",bf:"boyfriend",btw:"by the way",cuz:"because",eg:"example",els:"else",f:"female",ftw:"for the win",fyi:"for your information",gf:"girlfriend",gotta:"got to",gr8:"great",hada:"had a",hmu:"hit me up",hr:"hour",hrs:"hours",idk:"I don't know",im:"I'm",jude:"Jude",kinda:"kind of",m:"male",msg:"message",nite:"night",na:"N/A","n/a":"N/A",omg:"oh my gosh",pls:"please",plz:"please",ppl:"people",tbh:"to be honest",tho:"though",thru:"through",tryna:"trying to",u:"you",w:"with",wanna:"want to",whaat:"what",whaaat:"what",wk:"week",wks:"weeks",wtf:"what the fuck",wth:"what the heck",wya:"where are you at",yknow:"you know"},b=function(c,d,e){if("undefined"!=typeof a[c])return a[c];if(!spellchecker.isMisspelled(c))return c;if(0===d.reduce(function(a,b){return a+(b.endIndex-b.startIndex)},0))return"";var f=0<e?e-1:d.length-1;return d[f].endIndex>d[f].startIndex?(--d[f].endIndex,c=c.substr(0,d[f].startIndex)+c.substr(d[f].startIndex+1)):0<e?--e:e=d.length-1,b(c,d,e)};return{fixStretching:function fixStretching(a){var c=[];if(Array.isArray(a))c=a;else if("string"==typeof a)c=a.split(" ");else return"";for(var d=[],e="",f=0;f<c.length;f++){for(var l=0;l<c[f].length;l++)0<l&&(c[f][l]===c[f][l-1]?""===e?(d.push({startIndex:l-1,endIndex:l}),e=c[f][l]):d[d.length-1].endIndex=l:e="");if(0<d.length&&"undefined"!=typeof c[f]&&spellchecker.isMisspelled(c[f]))for(var g="",h=JSON.parse(JSON.stringify(d)),k=0;k<h.length;k++){if(g=b(c[f],h,k),""!==g){c[f]=g;break}h=JSON.parse(JSON.stringify(d))}d=[],e=""}return c},fixShorthand:function fixShorthand(b){var c="",d=[],e="";if(Array.isArray(b))d=b;else if("string"==typeof b)d=b.split(" ");else return"";for(var f=0;f<d.length;f++)e=d[f].match(/([a-zA-Z0-9']*)([\?!\.;+]*)$/),""!=typeof e[2]&&(c=e[2]),e=e[1],"undefined"!=typeof a[e]&&(d[f]=a[e],""!==c&&(d[f]+=c,c=""));return d}}}function Grammarify_Disconnected(){var a=["awesome","everything","herself","himself","nowhere","today","yourself"];return{fixSeparated:function fixSeparated(b){var c=[];if(Array.isArray(b))c=b;else if("string"==typeof b)c=b.split(" ");else return"";var d=0;if(1<c.length)for(var e=1;e<c.length;e++)d=a.indexOf((c[e-1]+c[e]).toLowerCase()),0<=d&&(c[e-1]=a[d],c.splice(e,1),e--);return c}}}function Grammarify_Numbers(){}